dist: xenial

language: go

go: 
  - 1.11.x

sudo: required

service:
  - docker  
  
install: true

before_script:
  - chmod a+x build/build.sh
  - ./build/build.sh

  - pushd .
  - cd /home/travis/gopath/src/github.com/h3copen/h3cfibservice/fibhandler
  - mv /home/travis/gopath/src/github.com/h3copen/h3copenr/dockerfile_fib .
  - docker build -f dockerfile_fib -t fib:test .
  - popd
  - docker pull lmke/h3c_openr:v5
  - docker run -itd --name complie_openr lmke/h3c_openr:v5  bash
  - docker exec -it complie_openr sh -c " git clone https://github.com/facebook/openr.git && cd /openr/build \
                                          && sed -i \"s/sudo//g \"  build_openr.sh  && ./build_openr.sh"
  - if [ $? -eq 0 ]
  -  then
  -   git log | head -1 >> commit.id.log
  -   docker cp /usr/local/sbin/openr .
  -   docker build -f dockerfile_openr -t openr:test .
  - else
  -   exit 1
  - fi
    

  - chmod +x build/test.sh
  
script:
  - ./build/test.sh
