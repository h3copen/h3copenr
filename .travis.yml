dist: xenial

language: go

go: 
  - 1.11.x

sudo: required

service:
  - docker  
  
install: true

before_script:
  - chmod a+x build/build.sh
  - ./build/build.sh
  - pushd .
  - cd /home/travis/gopath/src/github.com/h3copen/h3cfibservice/fibhandler
  - docker build -f dockerfile_openr -t fib:test .
  - docker run -itd --name ubuntu ubuntu:16.04 /bin/bash 
  - popd
  - docker pull lmke/h3c_openr:v5
  - docker run -itd --name complie_openr lmke/h3c_openr:v5  bash
  - docker exec -it complie_openr sh -c " git clone https://github.com/facebook/openr.git && cd /openr/build \
                                          && sed -i \"s/sudo//g \"  build_openr.sh  && ./build_openr.sh"

  - chmod +x build/test.sh
  
script:
  - ./build/test.sh
